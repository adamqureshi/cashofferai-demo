<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cash Offer AI - Vehicle Valuation</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 90%;
            padding: 40px;
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 40px;
        }
        
        .step {
            flex: 1;
            text-align: center;
            position: relative;
        }
        
        .step::after {
            content: '';
            position: absolute;
            top: 15px;
            right: -50%;
            width: 100%;
            height: 2px;
            background: #e0e0e0;
            z-index: -1;
        }
        
        .step:last-child::after {
            display: none;
        }
        
        .step-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e0e0e0;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .step.active .step-circle {
            background: #667eea;
        }
        
        .step.completed .step-circle {
            background: #4caf50;
        }
        
        .step-label {
            font-size: 12px;
            color: #666;
        }
        
        .chat-container {
            height: 400ouzpx;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            background: #f9f9f9;
        }
        
        .message {
            margin-bottom: 15px;
            display: flex;
            align-items: flex-start;
        }
        
        .message.user {
            justify-content: flex-end;
        }
        
        .message-bubble {
            max-width: 70%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.4;
        }
        
        .message.ai .message-bubble {
            background: white;
            color: #333;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .message.user .message-bubble {
            background: #667eea;
            color: white;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .input-field {
            flex: 1;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        .input-field:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .btn {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .btn:hover {
            background: #5a67d8;
        }
        
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .condition-options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .condition-card {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .condition-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }
        
        .condition-card.selected {
            background: #f0f4ff;
            border-color: #667eea;
        }
        
        .image-upload {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .image-upload:hover {
            background: #f0f4ff;
        }
        
        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 10px;
            margin-top: 20px;
        }
        
        .image-preview img {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: 5px;
        }
        
        .offer-display {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-top: 20px;
        }
        
        .offer-amount {
            font-size: 48px;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .handoff-notice {
            background: #fff3cd;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 style="text-align: center; color: #333; margin-bottom: 30px;">Cash Offer AI</h1>
        
        <!-- Step Indicator -->
        <div class="step-indicator">
            <div class="step active" id="step1">
                <div class="step-circle">1</div>
                <div class="step-label">VIN</div>
            </div>
            <div class="step" id="step2">
                <div class="step-circle">2</div>
                <div class="step-label">Condition</div>
            </div>
            <div class="step" id="step3">
                <div class="step-circle">3</div>
                <div class="step-label">History</div>
            </div>
            <div class="step" id="step4">
                <div class="step-circle">4</div>
                <div class="step-label">Images</div>
            </div>
            <div class="step" id="step5">
                <div class="step-circle">5</div>
                <div class="step-label">Offer</div>
            </div>
        </div>
        
        <!-- Chat Container -->
        <div class="chat-container" id="chatContainer">
            <div class="message ai">
                <div class="message-bubble">
                    👋 Welcome! I'm Cash Offer AI. I'll help you get an instant cash offer for your vehicle. Let's start with your VIN number.
                </div>
            </div>
        </div>
        
        <!-- Dynamic Input Area -->
        <div id="dynamicInputArea">
            <!-- VIN Input -->
            <div class="input-group" id="vinInput">
                <input type="text" class="input-field" placeholder="Enter your 17-character VIN" maxlength="17" id="vinField">
                <button class="btn" onclick="submitVIN()">Submit VIN</button>
            </div>
        </div>
        
        <!-- Hidden sections to be shown progressively -->
        <div id="conditionSection" style="display: none;">
            <h3>Vehicle Condition</h3>
            <div class="condition-options">
                <div class="condition-card" onclick="selectCondition('excellent')">
                    <h4>Excellent</h4>
                    <p>Like new, no issues</p>
                </div>
                <div class="condition-card" onclick="selectCondition('good')">
                    <h4>Good</h4>
                    <p>Minor wear, fully functional</p>
                </div>
                <div class="condition-card" onclick="selectCondition('fair')">
                    <h4>Fair</h4>
                    <p>Some issues, driveable</p>
                </div>
                <div class="condition-card" onclick="selectCondition('poor')">
                    <h4>Poor</h4>
                    <p>Major issues needed</p>
                </div>
            </div>
            <button class="btn" onclick="submitCondition()">Continue</button>
        </div>
        
        <div id="historySection" style="display: none;">
            <h3>Accident History</h3>
            <div class="input-group">
                <select class="input-field" id="accidentHistory">
                    <option value="">Select accident history</option>
                    <option value="none">No accidents</option>
                    <option value="minor">Minor accident(s)</option>
                    <option value="major">Major accident(s)</option>
                </select>
                <button class="btn" onclick="submitHistory()">Continue</button>
            </div>
        </div>
        
        <div id="imageSection" style="display: none;">
            <h3>Upload Vehicle Images</h3>
            <div class="image-upload" onclick="document.getElementById('imageInput').click()">
                <p>📷 Click to upload images</p>
                <p style="font-size: 12px; color: #666;">Upload front, back, sides, and interior</p>
            </div>
            <input type="file" id="imageInput" multiple accept="image/*" style="display: none;" onchange="handleImageUpload(event)">
            <div class="image-preview" id="imagePreview"></div>
            <button class="btn" onclick="submitImages()" style="margin-top: 20px;">Generate Offer</button>
        </div>
        
        <div id="offerSection" style="display: none;">
            <div class="offer-display">
                <h2>Your Cash Offer</h2>
                <div class="offer-amount" id="offerAmount">$--,---</div>
                <p>Valid for 7 days</p>
                <button class="btn" style="background: white; color: #667eea; margin-top: 20px;">Accept Offer</button>
            </div>
        </div>
        
        <div id="handoffSection" style="display: none;">
            <div class="handoff-notice">
                <h3>🤝 Connecting You with a Specialist</h3>
                <p>I need to connect you with one of our expert buyers to better assist with your specific situation. They'll be with you shortly!</p>
            </div>
        </div>
    </div>
    
    <script>
        // Configuration
        const API_URL = 'https://cashofferai-backend-a0ga11p98-adamqureshis-projects.vercel.app/api'; // Change this to your backend URL
        let currentStep = 1;
        let vehicleData = {};
        let conversationId = generateId();
        
        function generateId() {
            return 'conv_' + Math.random().toString(36).substr(2, 9);
        }
        
        // Add message to chat
        function addMessage(content, isUser = false) {
            const chatContainer = document.getElementById('chatContainer');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;
            messageDiv.innerHTML = `
                <div class="message-bubble">${content}</div>
            `;
            chatContainer.appendChild(messageDiv);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // VIN Submission
        async function submitVIN() {
            const vin = document.getElementById('vinField').value;
            if (vin.length !== 17) {
                alert('Please enter a valid 17-character VIN');
                return;
            }
            
            addMessage(vin, true);
            
            try {
                const response = await fetch(`${API_URL}/vehicle/decode-vin`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ vin })
                });
                
                const data = await response.json();
                vehicleData = data.vehicleData;
                
                addMessage(`Great! I found your ${vehicleData.year} ${vehicleData.make} ${vehicleData.model}. Now, let's assess the condition of your vehicle.`);
                
                moveToStep(2);
                document.getElementById('vinInput').style.display = 'none';
                document.getElementById('conditionSection').style.display = 'block';
                
            } catch (error) {
                addMessage('Sorry, I had trouble processing that VIN. Please try again or I can connect you with a specialist.');
                checkForHandoff();
            }
        }
        
        // Condition Selection
        let selectedCondition = null;
        
        function selectCondition(condition) {
            selectedCondition = condition;
            document.querySelectorAll('.condition-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
        }
        
        async function submitCondition() {
            if (!selectedCondition) {
                alert('Please select a condition');
                return;
            }
            
            addMessage(`Condition: ${selectedCondition}`, true);
            vehicleData.condition = selectedCondition;
            
            addMessage('Thanks! Now I need to know about any accident history.');
            
            moveToStep(3);
            document.getElementById('conditionSection').style.display = 'none';
            document.getElementById('historySection').style.display = 'block';
        }
        
        // History Submission
        async function submitHistory() {
            const history = document.getElementById('accidentHistory').value;
            if (!history) {
                alert('Please select accident history');
                return;
            }
            
            addMessage(`Accident history: ${history}`, true);
            vehicleData.accidentHistory = history;
            
            addMessage('Perfect! Finally, please upload some photos of your vehicle so I can finalize your offer.');
            
            moveToStep(4);
            document.getElementById('historySection').style.display = 'none';
            document.getElementById('imageSection').style.display = 'block';
        }
        
        // Image Upload
        let uploadedImages = [];
        
        function handleImageUpload(event) {
            const files = event.target.files;
            const preview = document.getElementById('imagePreview');
            
            for (let file of files) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    preview.appendChild(img);
                    uploadedImages.push(e.target.result);
                };
                reader.readAsDataURL(file);
            }
        }
        
        // Generate Offer
        async function submitImages() {
            if (uploadedImages.length === 0) {
                alert('Please upload at least one image');
                return;
            }
            
            addMessage('Images uploaded successfully!', true);
            addMessage('Analyzing your vehicle and generating your cash offer...');
            
            // Simulate API call
            setTimeout(() => {
                const offer = calculateOffer(vehicleData);
                displayOffer(offer);
            }, 2000);
        }
        
        function calculateOffer(data) {
            // Simplified offer calculation
            let baseValue = 25000; // This would come from your VIN decoder/market data
            
            const conditionMultiplier = {
                excellent: 1.0,
                good: 0.9,
                fair: 0.75,
                poor: 0.5
            };
            
            const historyMultiplier = {
                none: 1.0,
                minor: 0.85,
                major: 0.6
            };
            
            const offerAmount = baseValue * 
                               conditionMultiplier[data.condition] * 
                               historyMultiplier[data.accidentHistory];
            
            return Math.round(offerAmount);
        }
        
        function displayOffer(amount) {
            moveToStep(5);
            document.getElementById('imageSection').style.display = 'none';
            document.getElementById('offerSection').style.display = 'block';
            document.getElementById('offerAmount').textContent = `$${amount.toLocaleString()}`;
            
            addMessage(`🎉 Your cash offer is ready: $${amount.toLocaleString()}! This offer is valid for 7 days.`);
        }
        
        // Step Management
        function moveToStep(step) {
            for (let i = 1; i <= 5; i++) {
                const stepEl = document.getElementById(`step${i}`);
                stepEl.classList.remove('active', 'completed');
                
                if (i < step) {
                    stepEl.classList.add('completed');
                } else if (i === step) {
                    stepEl.classList.add('active');
                }
            }
            currentStep = step;
        }
        
        // Handoff Detection
        async function checkForHandoff() {
            // This would check with your backend
            const needsHandoff = true; // Simplified
            
            if (needsHandoff) {
                document.getElementById('handoffSection').style.display = 'block';
                
                // Notify backend to create handoff ticket
                await fetch(`${API_URL}/handoff/create`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ conversationId })
                });
            }
        }
        
        // Initialize
        console.log('Cash Offer AI initialized');
    </script>
</body>
</html>
